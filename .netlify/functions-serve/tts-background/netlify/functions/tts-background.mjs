
import {createRequire as ___nfyCreateRequire} from "module";
import {fileURLToPath as ___nfyFileURLToPath} from "url";
import {dirname as ___nfyPathDirname} from "path";
let __filename=___nfyFileURLToPath(import.meta.url);
let __dirname=___nfyPathDirname(___nfyFileURLToPath(import.meta.url));
let require=___nfyCreateRequire(import.meta.url);


// netlify/functions/tts-background.mjs
import OpenAI from "openai";
import FormData from "form-data";
import fetch from "node-fetch";
import { JSDOM } from "jsdom";
var DIRECTUS_URL = process.env.DIRECTUS_URL;
var DIRECTUS_AUTH_TOKEN = process.env.DIRECTUS_AUTH_TOKEN;
var openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});
async function directusFetch(endpoint, method = "GET", body = null) {
  const url = `${DIRECTUS_URL}${endpoint}`;
  const headers = {
    "Authorization": `Bearer ${DIRECTUS_AUTH_TOKEN}`,
    "Content-Type": "application/json"
  };
  const options = {
    method,
    headers
  };
  if (body) {
    options.body = JSON.stringify(body);
  }
  const response = await fetch(url, options);
  if (!response.ok) {
    const errorDetails = await response.text();
    throw new Error(`Directus API request failed: ${response.status} - ${errorDetails}`);
  }
  return response.json();
}
async function readDirectusItem(collection, itemId) {
  const endpoint = `/items/${collection}/${itemId}?fields=*.*,authors.team_id.*`;
  return directusFetch(endpoint);
}
async function runProcess(bodyres) {
  try {
    let getFullName = function(author) {
      return `${author.team_id.First_Name} ${author.team_id.Last_Name}`;
    }, joinAuthorNames = function(authors2) {
      if (authors2.length === 1) {
        return getFullName(authors2[0]);
      } else {
        return authors2.map(getFullName).join(", ").replace(/, (?=[^,]+$)/, " and ");
      }
    };
    const article = await readDirectusItem(bodyres.collection, bodyres.id);
    const { content, slug, title, authors, audio_version } = article.data;
    let textContent = `${title} 
 ${joinAuthorNames(authors).length > 0 ? "\nby" : ""} ${joinAuthorNames(authors)} 
${extractTextFromHTML(content)}`;
    console.log("textContent", textContent);
    let allSpeechBuffers = [];
    if (textContent.length > 4096) {
      const chunks = splitText(textContent, 4096);
      for (const chunk of chunks) {
        console.log(chunk.length);
        const buffer = await generateSpeech(chunk);
        allSpeechBuffers.push(buffer);
      }
    } else {
      const buffer = await generateSpeech(textContent);
      allSpeechBuffers.push(buffer);
    }
    const combinedBuffer = Buffer.concat(allSpeechBuffers);
    const uploadResult = await uploadBuffer(combinedBuffer, slug, bodyres.collection, bodyres.id, audio_version);
    console.log("uploadResult", uploadResult);
    const updateResult = await updateArticleWithAudioId(bodyres.collection, bodyres.id, uploadResult.data.id);
    console.log("updateResult", updateResult);
    return updateResult;
  } catch (error) {
    console.error("Error in processing article and generating speech:", error);
  }
}
async function generateSpeech(text) {
  const response = await openai.audio.speech.create({
    model: "tts-1-hd",
    voice: "shimmer",
    input: text
  });
  if (response.status !== 200) {
    throw new Error("Failed to generate speech from OpenAI.");
  }
  const chunks = [];
  for await (const chunk of response.body) {
    chunks.push(chunk instanceof Buffer ? chunk : Buffer.from(chunk));
  }
  return Buffer.concat(chunks);
}
async function uploadBuffer(buffer, slug, audio_version) {
  const form = new FormData();
  form.append("file", buffer, {
    filename: slug + ".mp3",
    contentType: "audio/mpeg",
    knownLength: buffer.length
  });
  const directusFileEndpoint = DIRECTUS_URL + "/files" + (audio_version ? "/" + audio_version.id : "");
  const headers = {
    "Authorization": "Bearer " + DIRECTUS_AUTH_TOKEN
    // replace with an actual token
  };
  const finalHeaders = { ...form.getHeaders(), ...headers };
  const fileResponse = await fetch(directusFileEndpoint, {
    method: audio_version ? "PATCH" : "POST",
    body: form,
    headers: finalHeaders
  });
  if (!fileResponse.ok) {
    const errorBody = await fileResponse.text();
    throw new Error(`Error uploading file: ${errorBody}`);
  }
  const directusResponse = await fileResponse.json();
  return directusResponse;
}
async function updateArticleWithAudioId(collection, itemId, audioFileId) {
  const directusItemEndpoint = DIRECTUS_URL + "/items/" + collection + "/" + itemId;
  const updateData = {
    audio_version: audioFileId
  };
  const headers = {
    "Content-Type": "application/json",
    "Authorization": "Bearer " + DIRECTUS_AUTH_TOKEN
  };
  const response = await fetch(directusItemEndpoint, {
    method: "PATCH",
    body: JSON.stringify(updateData),
    headers
  });
  if (!response.ok) {
    const errorBody = await response.text();
    throw new Error(`Error updating item: ${errorBody}`);
  }
  const jsonResponse = await response.json();
  return jsonResponse;
}
var tts_background_default = async (req, context) => {
  const bodyres = await req.json();
  console.log(bodyres);
  await runProcess(bodyres);
};
function extractTextFromHTML(html) {
  const dom = new JSDOM(html);
  const document = dom.window.document;
  function walkNode(node, text = "") {
    if (node.nodeType === 1 && ["SCRIPT", "STYLE", "IMG", "FIGCAPTION"].includes(node.tagName)) {
      return text;
    }
    if (node.nodeType === 3) {
      text += node.textContent;
    } else if (node.nodeType === 1) {
      if (["P", "BR", "DIV", "LI", "H1", "H2", "H3", "H4", "H5", "H6"].includes(node.tagName)) {
        text += node.textContent + "\n";
      } else {
        for (const childNode of node.childNodes) {
          text = walkNode(childNode, text);
        }
      }
    }
    return text;
  }
  return walkNode(document.body);
}
function splitText(text, maxLength) {
  const sentenceEndings = [".", "!", "?"];
  let chunks = [];
  let startIndex = 0;
  while (startIndex < text.length) {
    let endIndex = Math.min(startIndex + maxLength, text.length);
    let lastBreakIndex = startIndex;
    for (let i = startIndex; i < endIndex; i++) {
      if (text[i] === "\n" || sentenceEndings.includes(text[i]) && text[i + 1] && text[i + 1] === " ") {
        lastBreakIndex = i + 1;
      }
    }
    if (lastBreakIndex > startIndex) {
      chunks.push(text.substring(startIndex, lastBreakIndex));
      startIndex = lastBreakIndex;
    } else {
      let nextBreakIndex = text.indexOf("\n", endIndex) || text.length;
      for (const ending of sentenceEndings) {
        let nextSentenceIndex = text.indexOf(ending + " ", endIndex);
        if (nextSentenceIndex !== -1 && (nextSentenceIndex < nextBreakIndex || nextBreakIndex === -1)) {
          nextBreakIndex = nextSentenceIndex + 1;
        }
      }
      nextBreakIndex = nextBreakIndex !== -1 ? nextBreakIndex : text.length;
      chunks.push(text.substring(startIndex, nextBreakIndex));
      startIndex = nextBreakIndex;
    }
  }
  return chunks;
}
export {
  tts_background_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibmV0bGlmeS9mdW5jdGlvbnMvdHRzLWJhY2tncm91bmQubWpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgT3BlbkFJIGZyb20gJ29wZW5haSc7XG5pbXBvcnQgRm9ybURhdGEgZnJvbSAnZm9ybS1kYXRhJztcbmltcG9ydCBmZXRjaCBmcm9tICdub2RlLWZldGNoJztcbmltcG9ydCB7IEpTRE9NIH0gZnJvbSAnanNkb20nO1xuXG4vLyBDb25maWd1cmF0aW9uIHZhcmlhYmxlc1xuY29uc3QgRElSRUNUVVNfVVJMID0gcHJvY2Vzcy5lbnYuRElSRUNUVVNfVVJMXG5jb25zdCBESVJFQ1RVU19BVVRIX1RPS0VOID0gcHJvY2Vzcy5lbnYuRElSRUNUVVNfQVVUSF9UT0tFTlxuXG5jb25zdCBvcGVuYWkgPSBuZXcgT3BlbkFJKHtcbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWSxcbn0pO1xuXG5cblxuLy8gRnVuY3Rpb24gdG8gbWFrZSByZXF1ZXN0cyB0byBEaXJlY3R1cyBBUElcbmFzeW5jIGZ1bmN0aW9uIGRpcmVjdHVzRmV0Y2goZW5kcG9pbnQsIG1ldGhvZCA9ICdHRVQnLCBib2R5ID0gbnVsbCkge1xuICBjb25zdCB1cmwgPSBgJHtESVJFQ1RVU19VUkx9JHtlbmRwb2ludH1gO1xuICBjb25zdCBoZWFkZXJzID0ge1xuICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke0RJUkVDVFVTX0FVVEhfVE9LRU59YCxcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICB9O1xuXG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgbWV0aG9kLFxuICAgIGhlYWRlcnMsXG4gIH07XG5cbiAgaWYgKGJvZHkpIHtcbiAgICBvcHRpb25zLmJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgfVxuXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCBvcHRpb25zKTtcblxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgY29uc3QgZXJyb3JEZXRhaWxzID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgIHRocm93IG5ldyBFcnJvcihgRGlyZWN0dXMgQVBJIHJlcXVlc3QgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c30gLSAke2Vycm9yRGV0YWlsc31gKTtcbiAgfVxuXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XG59XG5cbi8vIEZ1bmN0aW9uIHRvIHJlYWQgYW4gaXRlbSBmcm9tIGEgY29sbGVjdGlvbiBieSBJRFxuYXN5bmMgZnVuY3Rpb24gcmVhZERpcmVjdHVzSXRlbShjb2xsZWN0aW9uLCBpdGVtSWQpIHtcbiAgY29uc3QgZW5kcG9pbnQgPSBgL2l0ZW1zLyR7Y29sbGVjdGlvbn0vJHtpdGVtSWR9P2ZpZWxkcz0qLiosYXV0aG9ycy50ZWFtX2lkLipgO1xuICByZXR1cm4gZGlyZWN0dXNGZXRjaChlbmRwb2ludCk7XG59XG5cblxuLy8gTWFpbiBmdW5jdGlvbiB0byBydW4gdGhlIHByb2Nlc3NcbmFzeW5jIGZ1bmN0aW9uIHJ1blByb2Nlc3MoYm9keXJlcykge1xuICAvLyBhc3luYyBmdW5jdGlvbiBydW5Qcm9jZXNzKCkge1xuICAvLyAgdmFyICBib2R5cmVzPSB7Y29sbGVjdGlvbjpcInJlYm9vdF9kZW1vY3JhY3lfYmxvZ1wiLCBpZDpcIjI4MTgyXCJ9XG4gIHRyeSB7XG4gICAgLy8gUmVhZCBhbiBpdGVtIGZyb20gdGhlIERpcmVjdHVzIGNvbGxlY3Rpb24gd2l0aCB0aGUgc3BlY2lmaWVkIElEXG4gICAgY29uc3QgYXJ0aWNsZSA9IGF3YWl0IHJlYWREaXJlY3R1c0l0ZW0oYm9keXJlcy5jb2xsZWN0aW9uLCBib2R5cmVzLmlkKTtcblxuICAgIC8vIEV4dHJhY3QgdGhlIGNvbnRlbnQgYW5kIGRhdGUgdXBkYXRlZCBmcm9tIHRoZSBhcnRpY2xlXG4gICAgY29uc3QgeyBjb250ZW50LCBzbHVnLCB0aXRsZSAsIGF1dGhvcnMsIGF1ZGlvX3ZlcnNpb24gICB9ID0gYXJ0aWNsZS5kYXRhO1xuICBcbiAgXG4gICAgLy8gRnVuY3Rpb24gdG8gZXh0cmFjdCB0aGUgZnVsbCBuYW1lIGZyb20gYW4gYXV0aG9yIG9iamVjdFxuICAgICAgZnVuY3Rpb24gZ2V0RnVsbE5hbWUoYXV0aG9yKSB7XG4gICAgICAgIHJldHVybiBgJHthdXRob3IudGVhbV9pZC5GaXJzdF9OYW1lfSAke2F1dGhvci50ZWFtX2lkLkxhc3RfTmFtZX1gO1xuICAgICAgfVxuXG4gICAgICAvLyBGdW5jdGlvbiB0byBqb2luIGF1dGhvciBuYW1lcyB3aXRoIGNvbW1hcyBhbmQgXCJhbmRcIlxuICAgICAgZnVuY3Rpb24gam9pbkF1dGhvck5hbWVzKGF1dGhvcnMpIHtcbiAgICAgICAgaWYgKGF1dGhvcnMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgLy8gT25seSBvbmUgYXV0aG9yLCBzbyBqdXN0IHJldHVybiB0aGUgZnVsbCBuYW1lXG4gICAgICAgICAgcmV0dXJuIGdldEZ1bGxOYW1lKGF1dGhvcnNbMF0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEpvaW4gbXVsdGlwbGUgYXV0aG9ycyB3aXRoIGNvbW1hcyBhbmQgcmVwbGFjZSB0aGUgbGFzdCBjb21tYSB3aXRoIFwiYW5kXCJcbiAgICAgICAgICByZXR1cm4gYXV0aG9ycy5tYXAoZ2V0RnVsbE5hbWUpLmpvaW4oJywgJykucmVwbGFjZSgvLCAoPz1bXixdKyQpLywgJyBhbmQgJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBcbiAgICBsZXQgdGV4dENvbnRlbnQgPSBgJHt0aXRsZX0gXFxuICR7am9pbkF1dGhvck5hbWVzKGF1dGhvcnMpLmxlbmd0aD4wPydcXG5ieSc6Jyd9ICR7am9pbkF1dGhvck5hbWVzKGF1dGhvcnMpfSBcXG4ke2V4dHJhY3RUZXh0RnJvbUhUTUwoY29udGVudCl9YDtcbiAgICBjb25zb2xlLmxvZygndGV4dENvbnRlbnQnLHRleHRDb250ZW50KTtcbiAgICAvLyBBbiBhcnJheSB0byBob2xkIGFsbCBzcGVlY2ggYnVmZmVyc1xuICAgIGxldCBhbGxTcGVlY2hCdWZmZXJzID0gW107XG4gICAgXG4gICAgLy8gQ2hlY2sgdGhlIGNvbnRlbnQgbGVuZ3RoIGFuZCBzcGxpdCBpZiBuZWNlc3NhcnlcbiAgICBpZiAodGV4dENvbnRlbnQubGVuZ3RoID4gNDA5Nikge1xuICAgICAgY29uc3QgY2h1bmtzID0gc3BsaXRUZXh0KHRleHRDb250ZW50LCA0MDk2KTtcblxuICAgLy8gUHJvY2VzcyBlYWNoIGNodW5rIHRvIGdlbmVyYXRlIHNwZWVjaFxuICAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3MpIHtcbiAgICBjb25zb2xlLmxvZyhjaHVuay5sZW5ndGgpO1xuICAgIGNvbnN0IGJ1ZmZlciA9IGF3YWl0IGdlbmVyYXRlU3BlZWNoKGNodW5rKTtcbiAgICBhbGxTcGVlY2hCdWZmZXJzLnB1c2goYnVmZmVyKTtcbiAgfVxuXG4gICAgICAvLyBmb3IgKGNvbnN0IGNodW5rIG9mIGNodW5rcykge1xuICAgICAgLy8gICBjb25zb2xlLmxvZyhjaHVuay5sZW5ndGgpO1xuICAgICAgLy8gICBhd2FpdCBnZW5lcmF0ZUFuZFVwbG9hZFNwZWVjaChjaHVuaywgZGF0ZV91cGRhdGVkLCBib2R5cmVzKTtcbiAgICAgIC8vIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gYXdhaXQgZ2VuZXJhdGVBbmRVcGxvYWRTcGVlY2godGV4dF90b19zcGVlY2gsIGRhdGVfdXBkYXRlZCwgYm9keXJlcyk7XG4gICAgICBjb25zdCBidWZmZXIgPSBhd2FpdCBnZW5lcmF0ZVNwZWVjaCh0ZXh0Q29udGVudCk7XG4gICAgICBhbGxTcGVlY2hCdWZmZXJzLnB1c2goYnVmZmVyKTtcbiAgICB9XG4gICAgIC8vIENvbmNhdGVuYXRlIGFsbCBzcGVlY2ggYnVmZmVycyBpbnRvIGEgc2luZ2xlIGJ1ZmZlclxuICAgICBjb25zdCBjb21iaW5lZEJ1ZmZlciA9IEJ1ZmZlci5jb25jYXQoYWxsU3BlZWNoQnVmZmVycyk7XG5cbiAgICAgIC8vIFVwbG9hZCBjb21iaW5lZCBidWZmZXJcbiAgICAgIFxuICAgIGNvbnN0IHVwbG9hZFJlc3VsdCA9IGF3YWl0IHVwbG9hZEJ1ZmZlcihjb21iaW5lZEJ1ZmZlciwgc2x1ZywgYm9keXJlcy5jb2xsZWN0aW9uLCBib2R5cmVzLmlkLCBhdWRpb192ZXJzaW9uKTtcbiAgICBjb25zb2xlLmxvZyhcInVwbG9hZFJlc3VsdFwiLHVwbG9hZFJlc3VsdCk7XG4gICAgICAvLyBVcGRhdGUgdGhlIGFydGljbGUgd2l0aCB0aGUgYXVkaW8gZmlsZSBJRFxuICAgICAgY29uc3QgdXBkYXRlUmVzdWx0ID0gYXdhaXQgdXBkYXRlQXJ0aWNsZVdpdGhBdWRpb0lkKGJvZHlyZXMuY29sbGVjdGlvbiwgYm9keXJlcy5pZCwgdXBsb2FkUmVzdWx0LmRhdGEuaWQpO1xuICAgICAgY29uc29sZS5sb2coXCJ1cGRhdGVSZXN1bHRcIix1cGRhdGVSZXN1bHQpO1xuICAgICAgcmV0dXJuIHVwZGF0ZVJlc3VsdDtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIHByb2Nlc3NpbmcgYXJ0aWNsZSBhbmQgZ2VuZXJhdGluZyBzcGVlY2g6JywgZXJyb3IpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlU3BlZWNoKHRleHQpIHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBvcGVuYWkuYXVkaW8uc3BlZWNoLmNyZWF0ZSh7XG4gICAgbW9kZWw6IFwidHRzLTEtaGRcIixcbiAgICB2b2ljZTogXCJzaGltbWVyXCIsXG4gICAgaW5wdXQ6IHRleHQsXG4gIH0pO1xuXG4gIC8vIENoZWNrIHRoZSByZXNwb25zZSBpcyBPS1xuICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBnZW5lcmF0ZSBzcGVlY2ggZnJvbSBPcGVuQUkuJyk7XG4gIH1cblxuICAvLyBDb2xsZWN0IHN0cmVhbSBkYXRhIGludG8gYSBidWZmZXIgZm9yIHRoZSBjaHVua1xuICBjb25zdCBjaHVua3MgPSBbXTtcbiAgZm9yIGF3YWl0IChjb25zdCBjaHVuayBvZiByZXNwb25zZS5ib2R5KSB7XG4gICAgY2h1bmtzLnB1c2goY2h1bmsgaW5zdGFuY2VvZiBCdWZmZXIgPyBjaHVuayA6IEJ1ZmZlci5mcm9tKGNodW5rKSk7XG4gIH1cbiAgcmV0dXJuIEJ1ZmZlci5jb25jYXQoY2h1bmtzKTsgLy8gUmV0dXJuIHRoZSBzaW5nbGUgc3BlZWNoIGJ1ZmZlciBmb3Igb25lIGNodW5rXG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZEJ1ZmZlcihidWZmZXIsIHNsdWcsIGF1ZGlvX3ZlcnNpb24pIHtcbiAgLy8gQ3JlYXRlIGZvcm0tZGF0YSBpbnN0YW5jZVxuIFxuICBjb25zdCBmb3JtID0gbmV3IEZvcm1EYXRhKCk7XG4gIGZvcm0uYXBwZW5kKCdmaWxlJywgYnVmZmVyLCB7XG4gICAgZmlsZW5hbWU6IHNsdWcgKyAnLm1wMycsXG4gICAgY29udGVudFR5cGU6ICdhdWRpby9tcGVnJyxcbiAgICBrbm93bkxlbmd0aDogYnVmZmVyLmxlbmd0aFxuICB9KTtcblxuICBjb25zdCBkaXJlY3R1c0ZpbGVFbmRwb2ludCA9IERJUkVDVFVTX1VSTCArICcvZmlsZXMnICsgKGF1ZGlvX3ZlcnNpb24/Jy8nK2F1ZGlvX3ZlcnNpb24uaWQ6JycpIDtcbiAgXG4gIC8vIFByZXBhcmUgdGhlIHJlcXVlc3QgaGVhZGVycyB3aXRoIHRoZSBCZWFyZXIgdG9rZW5cbiAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAnQXV0aG9yaXphdGlvbic6ICdCZWFyZXIgJyArIERJUkVDVFVTX0FVVEhfVE9LRU4sIC8vIHJlcGxhY2Ugd2l0aCBhbiBhY3R1YWwgdG9rZW5cbiAgfTtcblxuICAvLyBNZXJnZSB0aGUgaGVhZGVycyBmcm9tIGZvcm0tZGF0YSB3aXRoIERpcmVjdHVzIHRva2VuXG4gIGNvbnN0IGZpbmFsSGVhZGVycyA9IHsgLi4uZm9ybS5nZXRIZWFkZXJzKCksIC4uLmhlYWRlcnMgfTtcblxuICAvLyBNYWtlIHRoZSByZXF1ZXN0IHRvIERpcmVjdHVzIHRvIHVwbG9hZCB0aGUgZmlsZVxuICBjb25zdCBmaWxlUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChkaXJlY3R1c0ZpbGVFbmRwb2ludCwge1xuICAgIG1ldGhvZDogYXVkaW9fdmVyc2lvbj8nUEFUQ0gnOidQT1NUJyxcbiAgICBib2R5OiBmb3JtLFxuICAgIGhlYWRlcnM6IGZpbmFsSGVhZGVyc1xuICB9KTtcblxuICBpZiAoIWZpbGVSZXNwb25zZS5vaykge1xuICAgIGNvbnN0IGVycm9yQm9keSA9IGF3YWl0IGZpbGVSZXNwb25zZS50ZXh0KCk7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciB1cGxvYWRpbmcgZmlsZTogJHtlcnJvckJvZHl9YCk7XG4gIH1cblxuICBjb25zdCBkaXJlY3R1c1Jlc3BvbnNlID0gYXdhaXQgZmlsZVJlc3BvbnNlLmpzb24oKTtcblxuICByZXR1cm4gZGlyZWN0dXNSZXNwb25zZTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlQXJ0aWNsZVdpdGhBdWRpb0lkKGNvbGxlY3Rpb24sIGl0ZW1JZCwgYXVkaW9GaWxlSWQpIHtcbiAgY29uc3QgZGlyZWN0dXNJdGVtRW5kcG9pbnQgPSBESVJFQ1RVU19VUkwgKyAnL2l0ZW1zLycgKyBjb2xsZWN0aW9uICsgJy8nICsgaXRlbUlkO1xuXG4gIGNvbnN0IHVwZGF0ZURhdGEgPSB7XG4gICAgYXVkaW9fdmVyc2lvbjogYXVkaW9GaWxlSWRcbiAgfTtcblxuICBjb25zdCBoZWFkZXJzID0ge1xuICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgJ0F1dGhvcml6YXRpb24nOiAnQmVhcmVyICcgKyBESVJFQ1RVU19BVVRIX1RPS0VOXG4gIH07XG5cbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChkaXJlY3R1c0l0ZW1FbmRwb2ludCwge1xuICAgIG1ldGhvZDogJ1BBVENIJyxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh1cGRhdGVEYXRhKSxcbiAgICBoZWFkZXJzOiBoZWFkZXJzXG4gIH0pO1xuXG4gIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICBjb25zdCBlcnJvckJvZHkgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFcnJvciB1cGRhdGluZyBpdGVtOiAke2Vycm9yQm9keX1gKTtcbiAgfVxuXG4gIGNvbnN0IGpzb25SZXNwb25zZSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgcmV0dXJuIGpzb25SZXNwb25zZTtcbn1cblxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAocmVxLCBjb250ZXh0KSA9PiB7XG4gIGNvbnN0IGJvZHlyZXMgPSBhd2FpdCByZXEuanNvbigpO1xuICBjb25zb2xlLmxvZyhib2R5cmVzKTtcbiAgYXdhaXQgcnVuUHJvY2Vzcyhib2R5cmVzKTsgLy8gU3RhcnQgdGhlIHByb2Nlc3MgdXNpbmcgdGhlIGJvZHkgb2YgdGhlIHJlcXVlc3Rcbn07XG5cblxuLy8vLy8gSEVMUEVSIC8vLy8vIFxuLy8gRnVuY3Rpb24gdG8gZXh0cmFjdCB0ZXh0IGZyb20gSFRNTFxuZnVuY3Rpb24gZXh0cmFjdFRleHRGcm9tSFRNTChodG1sKSB7XG4gIGNvbnN0IGRvbSA9IG5ldyBKU0RPTShodG1sKTtcbiAgY29uc3QgZG9jdW1lbnQgPSBkb20ud2luZG93LmRvY3VtZW50O1xuXG4gIGZ1bmN0aW9uIHdhbGtOb2RlKG5vZGUsIHRleHQgPSAnJykge1xuICAgIC8vIFNraXAgc2NyaXB0LCBzdHlsZSwgaW1nLCBhbmQgZmlnY2FwdGlvbiB0YWdzXG4gICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEgJiYgWydTQ1JJUFQnLCAnU1RZTEUnLCAnSU1HJywgJ0ZJR0NBUFRJT04nXS5pbmNsdWRlcyhub2RlLnRhZ05hbWUpKSB7XG4gICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG5cbiAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMykgeyAvLyBUZXh0IG5vZGVcbiAgICAgIHRleHQgKz0gbm9kZS50ZXh0Q29udGVudDtcbiAgICB9IGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHsgLy8gRWxlbWVudFxuICAgICAgaWYgKFsnUCcsICdCUicsICdESVYnLCAnTEknLCAnSDEnLCAnSDInLCAnSDMnLCAnSDQnLCAnSDUnLCAnSDYnXS5pbmNsdWRlcyhub2RlLnRhZ05hbWUpKSB7XG4gICAgICAgIHRleHQgKz0gbm9kZS50ZXh0Q29udGVudCArICdcXG4nOyAvLyBBZGQgYSBuZXdsaW5lIGZvciBibG9jay1sZXZlbCBlbGVtZW50c1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gT3RoZXJ3aXNlIHJlY3Vyc2l2ZWx5IGNoZWNrIGZvciB0ZXh0IG5vZGVzXG4gICAgICAgIGZvciAoY29uc3QgY2hpbGROb2RlIG9mIG5vZGUuY2hpbGROb2Rlcykge1xuICAgICAgICAgIHRleHQgPSB3YWxrTm9kZShjaGlsZE5vZGUsIHRleHQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0ZXh0O1xuICB9XG5cbiAgcmV0dXJuIHdhbGtOb2RlKGRvY3VtZW50LmJvZHkpO1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gc3BsaXQgdGV4dCBpbnRvIGNodW5rcyBieSBwYXJhZ3JhcGhzIG9yIHNlbnRlbmNlc1xuZnVuY3Rpb24gc3BsaXRUZXh0KHRleHQsIG1heExlbmd0aCkge1xuICBjb25zdCBzZW50ZW5jZUVuZGluZ3MgPSBbJy4nLCAnIScsICc/J107IC8vIFNlbnRlbmNlIGVuZGluZyBjaGFyYWN0ZXJzXG4gIGxldCBjaHVua3MgPSBbXTtcbiAgbGV0IHN0YXJ0SW5kZXggPSAwO1xuXG4gIHdoaWxlIChzdGFydEluZGV4IDwgdGV4dC5sZW5ndGgpIHtcbiAgICBsZXQgZW5kSW5kZXggPSBNYXRoLm1pbihzdGFydEluZGV4ICsgbWF4TGVuZ3RoLCB0ZXh0Lmxlbmd0aCk7XG4gICAgbGV0IGxhc3RCcmVha0luZGV4ID0gc3RhcnRJbmRleDsgLy8gU3RvcmUgdGhlIGxhc3QgaW5kZXggb2YgYSBzZW50ZW5jZSBvciBwYXJhZ3JhcGggYnJlYWtcblxuICAgIC8vIExvb2sgZm9yIHRoZSBjbG9zZXN0IHNlbnRlbmNlIG9yIHBhcmFncmFwaCBicmVhayB3aXRoaW4gdGhlIGN1cnJlbnQgY2h1bmtcbiAgICBmb3IgKGxldCBpID0gc3RhcnRJbmRleDsgaSA8IGVuZEluZGV4OyBpKyspIHtcbiAgICAgIGlmICh0ZXh0W2ldID09PSAnXFxuJyB8fCAoc2VudGVuY2VFbmRpbmdzLmluY2x1ZGVzKHRleHRbaV0pICYmIHRleHRbaSArIDFdICYmIHRleHRbaSArIDFdID09PSAnICcpKSB7XG4gICAgICAgIGxhc3RCcmVha0luZGV4ID0gaSArIDE7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIElmIGEgc2VudGVuY2Ugb3IgcGFyYWdyYXBoIGVuZGluZyB3YXMgZm91bmQsIHVzZSBpdCBhcyB0aGUgc3BsaXQgcG9pbnRcbiAgICBpZiAobGFzdEJyZWFrSW5kZXggPiBzdGFydEluZGV4KSB7XG4gICAgICBjaHVua3MucHVzaCh0ZXh0LnN1YnN0cmluZyhzdGFydEluZGV4LCBsYXN0QnJlYWtJbmRleCkpO1xuICAgICAgc3RhcnRJbmRleCA9IGxhc3RCcmVha0luZGV4O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJZiBubyBzdWl0YWJsZSBicmVhayB3YXMgZm91bmQgd2l0aGluIHRoZSBtYXhMZW5ndGgsIGxvb2sgZm9yIHRoZSBuZXh0IHBvc3NpYmxlIGJyZWFrXG4gICAgICBsZXQgbmV4dEJyZWFrSW5kZXggPSB0ZXh0LmluZGV4T2YoJ1xcbicsIGVuZEluZGV4KSB8fCB0ZXh0Lmxlbmd0aDtcbiAgICAgIGZvciAoY29uc3QgZW5kaW5nIG9mIHNlbnRlbmNlRW5kaW5ncykge1xuICAgICAgICBsZXQgbmV4dFNlbnRlbmNlSW5kZXggPSB0ZXh0LmluZGV4T2YoZW5kaW5nICsgJyAnLCBlbmRJbmRleCk7XG4gICAgICAgIGlmIChuZXh0U2VudGVuY2VJbmRleCAhPT0gLTEgJiYgKG5leHRTZW50ZW5jZUluZGV4IDwgbmV4dEJyZWFrSW5kZXggfHwgbmV4dEJyZWFrSW5kZXggPT09IC0xKSkge1xuICAgICAgICAgIG5leHRCcmVha0luZGV4ID0gbmV4dFNlbnRlbmNlSW5kZXggKyAxO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNwbGl0IGF0IG5leHRCcmVha0luZGV4IG9yIGF0IHRoZSBlbmQgb2YgdGV4dCBpZiBubyBicmVhayBpcyBmb3VuZFxuICAgICAgbmV4dEJyZWFrSW5kZXggPSBuZXh0QnJlYWtJbmRleCAhPT0gLTEgPyBuZXh0QnJlYWtJbmRleCA6IHRleHQubGVuZ3RoO1xuICAgICAgY2h1bmtzLnB1c2godGV4dC5zdWJzdHJpbmcoc3RhcnRJbmRleCwgbmV4dEJyZWFrSW5kZXgpKTtcbiAgICAgIHN0YXJ0SW5kZXggPSBuZXh0QnJlYWtJbmRleDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gY2h1bmtzO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjaGVja0V4aXN0aW5nRmlsZShjb2xsZWN0aW9uLCBjb2xsZWN0aW9uSWQpIHtcbiAgLy8gRGVmaW5lIHRoZSBlbmRwb2ludCB0byBzZWFyY2ggZm9yIGZpbGVzIHdpdGggdGhlIHNwZWNpZmllZCB0YWdzXG4gIGNvbnN0IHF1ZXJ5ID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgJ2ZpbHRlclt0YWdzXVtfY29udGFpbnNdJzogW2NvbGxlY3Rpb24sIGNvbGxlY3Rpb25JZF0uam9pbignLCcpXG4gIH0pO1xuICBjb25zdCBkaXJlY3R1c0ZpbGVTZWFyY2hFbmRwb2ludCA9IERJUkVDVFVTX1VSTCArICcvZmlsZXM/JyArIHF1ZXJ5LnRvU3RyaW5nKCk7XG5cbiAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAnQXV0aG9yaXphdGlvbic6ICdCZWFyZXIgJyArIERJUkVDVFVTX0FVVEhfVE9LRU5cbiAgfTtcblxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGRpcmVjdHVzRmlsZVNlYXJjaEVuZHBvaW50LCB7IGhlYWRlcnMgfSk7XG4gIFxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgY29uc3QgZXJyb3JCb2R5ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3Igc2VhcmNoaW5nIGZvciBmaWxlOiAke2Vycm9yQm9keX1gKTtcbiAgfVxuXG4gIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gIHJldHVybiBkYXRhLmRhdGEgJiYgZGF0YS5kYXRhLmxlbmd0aCA+IDAgPyBkYXRhLmRhdGFbMF0gOiBudWxsO1xufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7OztBQUFBLE9BQU8sWUFBWTtBQUNuQixPQUFPLGNBQWM7QUFDckIsT0FBTyxXQUFXO0FBQ2xCLFNBQVMsYUFBYTtBQUd0QixJQUFNLGVBQWUsUUFBUSxJQUFJO0FBQ2pDLElBQU0sc0JBQXNCLFFBQVEsSUFBSTtBQUV4QyxJQUFNLFNBQVMsSUFBSSxPQUFPO0FBQUEsRUFDeEIsUUFBUSxRQUFRLElBQUk7QUFDdEIsQ0FBQztBQUtELGVBQWUsY0FBYyxVQUFVLFNBQVMsT0FBTyxPQUFPLE1BQU07QUFDbEUsUUFBTSxNQUFNLEdBQUcsWUFBWSxHQUFHLFFBQVE7QUFDdEMsUUFBTSxVQUFVO0FBQUEsSUFDZCxpQkFBaUIsVUFBVSxtQkFBbUI7QUFBQSxJQUM5QyxnQkFBZ0I7QUFBQSxFQUNsQjtBQUVBLFFBQU0sVUFBVTtBQUFBLElBQ2Q7QUFBQSxJQUNBO0FBQUEsRUFDRjtBQUVBLE1BQUksTUFBTTtBQUNSLFlBQVEsT0FBTyxLQUFLLFVBQVUsSUFBSTtBQUFBLEVBQ3BDO0FBRUEsUUFBTSxXQUFXLE1BQU0sTUFBTSxLQUFLLE9BQU87QUFFekMsTUFBSSxDQUFDLFNBQVMsSUFBSTtBQUNoQixVQUFNLGVBQWUsTUFBTSxTQUFTLEtBQUs7QUFDekMsVUFBTSxJQUFJLE1BQU0sZ0NBQWdDLFNBQVMsTUFBTSxNQUFNLFlBQVksRUFB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
